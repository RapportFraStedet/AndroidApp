(!window.console||!console.log)&&function(){for(var c=function(){},a="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,markTimeline,table,time,timeEnd,timeStamp,trace,warn".split(","),b=a.length,d=window.console={};b--;)d[a[b]]=c}();
Modernizr.load({test:Modernizr.inputtypes.date,yep:"js/vendor/date.js",nope:["css/jqm-datebox.css","js/vendor/jqm-datebox.core.js","js/vendor/jqm-datebox.mode.calbox.js","js/vendor/jquery.mobile.datebox.i18n.da.utf8.js","js/vendor/no-date.js"]});function html5Camera(){return!(!navigator.getUserMedia&&!navigator.webkitGetUserMedia&&!navigator.mozGetUserMedia&&!navigator.msGetUserMedia)}function html5File(){return window.File&&window.FileReader&&window.FileList&&window.Blob}
typeof cordova!="undefined"?Modernizr.load({load:"js/vendor/camera-cordova.js"}):html5File()||html5Camera()?Modernizr.load({load:"js/vendor/camera-html5.js"}):Modernizr.load({load:"js/vendor/camera.js"});
var url="http://ec2-46-137-153-98.eu-west-1.compute.amazonaws.com/RapportFraStedet/api/kommune.aspx",imageId,x=0,y=0;$(document).bind("mobileinit",function(){$.mobile.loadingMessageTextVisible=!0});
$("[data-role=page]").live("pageshow",function(b){try{var e=!1,c="";switch(b.currentTarget.id){case "AlleKommuner":document.title="Alle Kommuner";c="#AlleKommuner";e=!0;break;case "Kommune":document.title=Rfs.kommune.Navn;c="#Kommune?nr="+Rfs.kommune.Nr;e=!0;break;case "Kort":document.title=Rfs.kommune.Navn+" - "+Rfs.tema.Navn+" - Kort";c="#Tema?id="+Rfs.tema.Id+"&Nr="+Rfs.kommune.Nr;e=!0;break;case "Formular":document.title=Rfs.kommune.Navn+" - "+Rfs.tema.Navn;c="#Formular";e=!0;break;case "PhotoPage":document.title=
Rfs.kommune.Navn+" - "+Rfs.tema.Navn+" - Kamera",c="#PhotoPage",e=!0}e&&(_gaq.push(["_setAccount","UA-24623853-2"]),_gaq.push(["_trackPageview",c]))}catch(a){}});
$("[data-role=dialog]").live("pageshow",function(b){try{var e=!1,c="";switch(b.currentTarget.id){case "Start":document.title="Rapport Fra Stedet";c="";e=!0;break;case "Advarsel":document.title=Rfs.kommune.Navn+" - Advarsel";c="#Advarsel";e=!0;break;case "Kvittering":document.title=Rfs.kommune.Navn+" - "+Rfs.tema.Navn+" - Kvittering",c="#Kvittering",e=!0}e&&(_gaq.push(["_setAccount","UA-24623853-2"]),_gaq.push(["_trackPageview",c]))}catch(a){}});
$(document).ready(function(){$(window).bind("resize orientationchange",function(){fixContentHeight()});Rfs.init();$.support.cors=!0});
function geoLocate(){x!=0&&y!=0?Rfs.showPosition():navigator.geolocation?($.mobile.showPageLoadingMsg("a","Finder position...",!1),navigator.geolocation.getCurrentPosition(function(b){$.mobile.hidePageLoadingMsg();x=b.coords.longitude;y=b.coords.latitude;Rfs.lat=b.coords.latitude;Rfs.lon=b.coords.longitude;Rfs.acc=b.coords.accuracy;var b=new Proj4js.Proj("EPSG:4326"),e=new Proj4js.Proj("EPSG:25832"),c=new Proj4js.Point(x,y);Proj4js.transform(b,e,c);x=c.x;y=c.y;Rfs.showPosition()},function(){$.mobile.hidePageLoadingMsg();
$.mobile.changePage("#AlleKommuner")},{enableHighAccuracy:!0,maximumAge:0,timeout:1E4})):$.mobile.changePage("#AlleKommuner",{transition:"slide"})}
$(document).bind("pageinit",function(b){if(b.target.id=="Start"){var e=$.mobile.path.parseUrl(window.location.href);e.hash.search(/^#Tema/)!==-1?(b.preventDefault(),Rfs.showTema(e,{})):e.hash.search(/^#Kommune/)!==-1?(b.preventDefault(),Rfs.showKommune(e,{})):$("#app").length>0&&(b=navigator.userAgent.toLowerCase(),b.indexOf("android")>-1?$("#app").html("<p>Installere Rapport Fra Stedet som app p\u00e5 din smartphone. Klik p\u00e5 nedenst\u00e5ende link.</p><a rel='external' data-ajax='false' href='http://www.rapportfrastedet.dk/RapportFraStedet.apk' ><img src='./img/android.png' alt='Android'/></a>"):(b.indexOf("ipad")>
-1||b.indexOf("iphone")>-1)&&$("#app").html("<p>Tilf\u00f8j Rapport Fra Stedet som genvej. Klik p\u00e5 <img src='./img/genvej.jpg' alt='genvej'/> i din browser og f\u00f8j til hjemmesk\u00e6rm."))}});
$(document).bind("pagebeforechange",function(b,e){if(typeof e.toPage==="string"){var c=$.mobile.path.parseUrl(e.toPage);c.hash.search(/^#Kommune/)!==-1?(b.preventDefault(),Rfs.showKommune(c,e.options)):c.hash.search(/^#AlleKommuner/)!==-1?(b.preventDefault(),Rfs.showAlleKommuner(c,e.options)):c.hash.search(/^#Tema/)!==-1?(b.preventDefault(),Rfs.showTema(c,e.options)):c.hash.search(/^#Advarsel/)!==-1?(b.preventDefault(),Rfs.showAdvarsel(c,e.options)):c.hash.search(/^#PhotoPage/)!==-1&&(b.preventDefault(),
imageId=c.hash.replace(/.*id=/,""),$.mobile.changePage($("#PhotoPage")))}});
$("#Progress").live("pageshow",function(){if(window.FormData){var b=$("#rapportForm")[0],e=new FormData(b);$(".imageCamera").each(function(){var b=this.id.replace("B","");e.append(b,this.src)});$(".current > span").hasClass("animate")&&$(".current > span").removeClass("animate");b=new XMLHttpRequest;b.open("POST",Rfs.url+"/api/SaveFormsData.aspx",!0);b.onerror=function(){alert("error")};b.onload=function(){$(".current > span").width("100%");if(this.status==200)$.mobile.changePage("#Kvittering",{transition:"slide"});
else{var b=JSON.parse(this.response);$("#errorMessage").html("<h3>"+b.Message+"</h3><p>"+b.ExceptionMessage+"</p>");$.mobile.changePage("#KvitteringError",{transition:"slide"})}};b.upload.onprogress=function(b){b.lengthComputable&&$(".current > span").width(b.loaded/b.total*100+"%")};b.send(e)}else $(".current > span").width("100%"),$(".current > span").hasClass("animate")||$(".current > span").addClass("animate"),b=$("#rapportForm")[0],b.action=Rfs.url+"/api/SaveFormsData.aspx",b.method="post",b.enctype=
"multipart/form-data",b.target="hiddenIFrame",b.submit(),$.mobile.changePage("#Kvittering")});
var Rfs={url:null,mapSet:null,temaer:null,tema:null,rapport:null,kommuner:null,kommune:null,useDrawControl:!1,showInfo:!0,lat:0,lon:0,acc:0,ajaxCheck:null,init:function(){$("#Kommune").page();$("#AlleKommuner").page();$("#Formular").page();$("#Advarsel").page();$("#Kort").page()},showAlleKommuner:function(b,e){Rfs.kommuner==null?($.mobile.showPageLoadingMsg("a","Henter kommuner...",!1),$.ajax({url:url,dataType:"jsonp",success:function(b){Rfs.kommuner=b;for(var a="",f=0;f<b.length;f++){var d=b[f];
a+="<li";d.ModtagerIndberetning==0?(a+=" data-icon='alert'>",a+="<a href='#Advarsel?nr="+d.Nr+"' data-transition='slide'>"):a+="><a href='#Kommune?nr="+d.Nr+"' data-transition='slide'>";d.Logo!=""&&(a+="<img src='http://ec2-46-137-153-98.eu-west-1.compute.amazonaws.com/RapportFraStedet/Images/Kommuner/"+d.Logo+"' />");a+="<h1>"+d.Navn+"</h1>";d.ModtagerIndberetning==0&&(a+="<a href='#Advarsel?nr="+d.Nr+"' data-theme='e' data-transition='slide'></a>");a+="</a></li>"}b=$("#AlleKommuner");f=b.children(":jqmData(role=content)");
f.find("ul").html(a);f.find("ul").listview("refresh");$.mobile.changePage(b,e)},error:function(){$.mobile.changePage("#ShowKommunerError")},complete:function(){$.mobile.hidePageLoadingMsg()}})):$.mobile.changePage($("#AlleKommuner"),e)},showKommune:function(b,e){e.dataUrl=b.hash;var c=b.hash.replace(/.*nr=/,"");if(c=="#Kommune")$.mobile.changePage($("#Kommune"),e);else{if(Rfs.kommuner!=null)for(var a=0;a<Rfs.kommuner.length;a++)if(Rfs.kommuner[a].Nr==c){Rfs.kommune=Rfs.kommuner[a];break}Rfs.kommune==
null?($.mobile.showPageLoadingMsg("a","Henter kommune...",!1),$.ajax({url:url,dataType:"jsonp",data:{nr:c},success:function(a){Rfs.kommune=a;if(a.ModtagerIndberetning)$.mobile.changePage("#Kommune?nr="+a.Nr);else{var d=$("#ModtagerIkkeIndberetning"),b=d.children(":jqmData(role=content)"),e="";e+="<h2>Du st\u00e5r i "+a.Navn+" Kommune</h2>";e+="<p>RapportFraStedet kan ikke indberette til denne kommune!</p>";Rfs.kommune.Besked!=""&&(e+="<p>"+a.Besked+"</p>");a.URL!=""&&(e+="<a href='"+a.URL+"' rel='external' data-ajax='false' data-role='button'>Kontakt</a>");
e+="<p>Du kan v\u00e6lge at indberette til en anden kommune.</p>";e+="<a href='#AlleKommuner' data-role='button' data-theme='b' >V\u00e6lg kommune</a>";b.html(e);d.trigger("create");$.mobile.changePage("#ModtagerIkkeIndberetning")}},error:function(){$.mobile.changePage("#ShowKommunerError")},complete:function(){$.mobile.hidePageLoadingMsg()}})):($.mobile.showPageLoadingMsg("a","Henter temaer...",!1),$.ajax({url:Rfs.kommune.URL+"/api/Tema.aspx",dataType:"jsonp",data:{nr:Rfs.kommune.Nr,x:x,y:y},success:function(a){Rfs.createKommune(a);
a=$("#Kommune");$.mobile.changePage(a,e)},error:function(){$.mobile.changePage("#ShowKommunerError")},complete:function(){$.mobile.hidePageLoadingMsg()}}))}},createKommune:function(b){Rfs.temaer=b;var b=$("#Kommune"),e=b.children(":jqmData(role=header)"),c="",c=e.find("img");c[0].src="http://ec2-46-137-153-98.eu-west-1.compute.amazonaws.com/RapportFraStedet/Images/Kommuner/"+Rfs.kommune.Logo;c[0].style.visibility=Rfs.kommune.Logo==""?"hidden":"visible";e.find("h1").html(Rfs.kommune.Navn+" Kommune");
c="";for(e=0;e<Rfs.temaer.length;e++){var a=Rfs.temaer[e];c+="<li";a.ModtagerIndberetning==0&&(c+=" data-icon='alert'");c+="><a href='#Tema?id="+a.Id+"&nr="+Rfs.kommune.Nr+"' data-transition='slide'>";a.Logo!=""&&(c+="<img src='"+a.Logo+"' />");c+="<h1>"+a.Navn+"</h1><p>"+a.Beskrivelse+"</p>";a.ModtagerIndberetning==0&&(c+="<a href='#Warning' data-theme='e' data-rel='dialog' data-transition='slide'></a>");c+="</a></li>"}e=b.children(":jqmData(role=content)");e.find("ul").html(c);e.find("ul").listview("refresh");
b.page()},showTema:function(b,e){e.dataUrl=b.hash;Rfs.rapport=null;var c=b.hash.split("&"),a=c[0].replace(/.*id=/,""),c=c[1].replace(/.*nr=/,"");if(Rfs.temaer==null)Rfs.kommune&&Rfs.kommune.Nr==c?($.mobile.showPageLoadingMsg("a","Henter tema...",!1),$.ajax({url:Rfs.kommune.URL+"/api/Tema.aspx",dataType:"jsonp",data:{nr:c,x:x,y:y},success:function(a){Rfs.createKommune(a);Rfs.showTema(b,e)},error:function(){$.mobile.changePage("#ShowKommunerError")},complete:function(){$.mobile.hidePageLoadingMsg()}})):
($.mobile.showPageLoadingMsg("a","Henter kommune...",!1),$.ajax({url:url,dataType:"jsonp",data:{nr:c},success:function(a){Rfs.kommune=a;Rfs.showTema(b,e)},error:function(){$.mobile.changePage("#ShowKommunerError")},complete:function(){$.mobile.hidePageLoadingMsg()}}));else{for(var f=0;f<Rfs.temaer.length;f++)if(Rfs.temaer[f].Id==a&&Rfs.temaer[f].Nr==c){Rfs.tema=Rfs.temaer[f];break}Rfs.tema!=null&&($.mobile.showPageLoadingMsg("a","Henter tema...",!1),$("#tegnList").html("<li data-role='divider' data-theme='a'>Tegnev\u00e6rkt\u00f8jer</li>"),
a=Rfs.tema.MapAgent.toLowerCase().replace("mapagent/mapagent.fcgi","fusion")+"/layers/mapguide/php/ApplicationDefinition.php?USERNAME=Anonymous&CLIENTAGENT=Rapport+Fra+Stedet+1.0.0&appid="+Rfs.tema.ApplicationDefinition,$.ajax({url:a,dataType:"jsonp",complete:function(){$.mobile.hidePageLoadingMsg()},error:function(){$.mobile.changePage("#ShowKommunerError")},success:function(a){Rfs.useDrawControl=!1;if(a.ApplicationDefinition&&a.ApplicationDefinition.length>0&&a.ApplicationDefinition[0].MapSet&&
a.ApplicationDefinition[0].MapSet.length>0){Rfs.mapSet=a.ApplicationDefinition[0].MapSet[0];oiorest.init();if(a.ApplicationDefinition[0].WidgetSet&&a.ApplicationDefinition[0].WidgetSet.length>0){for(widget in a.ApplicationDefinition[0].WidgetSet[0].Widget){var b=a.ApplicationDefinition[0].WidgetSet[0].Widget[widget];switch(b.Type[0]){case "RfsSearch":var c=b.Extension[0],f=new Search(widget,b.Name[0],b.Disabled[0]=="false");f.placeholder1=c.placeholder1[0];f.url1=c.url1[0].replace(/%26/gi,"&");f.id1=
c.id1[0];f.name1=c.name1[0];f.chars1=c.chars1[0];f.title1=c.title1[0];if(c.placeholder2)f.placeholder2=c.placeholder2[0];if(c.url2)f.url2=c.url2[0].replace(/%26/gi,"&");if(c.id2)f.id2=c.id2[0];if(c.name2)f.name2=c.name2[0];if(c.chars2)f.chars2=c.chars2[0];if(c.title2)f.title2=c.title2[0];if(c.placeholder3)f.placeholder3=c.placeholder3[0];if(c.url3)f.url3=c.url3[0].replace(/%26/gi,"&");if(c.id3)f.id3=c.id3[0];if(c.name3)f.name3=c.name3[0];if(c.chars3)f.chars3=c.chars3[0];if(c.title3)f.title3=c.title3[0];
f.url=c.url[0].replace(/%26/gi,"&");f.x1=c.x1[0];f.y1=c.y1[0];f.projection=c.projection[0];oiorest.items.push(f);break;case "RapportFraStedet":c=b.Extension[0];if(c.type[0]!="0")$("#tegnList").html("<li data-role='divider' data-theme='a'>Tegnev\u00e6rkt\u00f8jer</li>"),Rfs.useDrawControl=!0;(c.type[0]=="1"||c.type[0]=="3"||c.type[0]=="5"||c.type[0]=="7")&&$("<li id='tegnPunkt' data-icon='check'><a href='#' data-rel='back' onclick='Point()'>Punkt</a></li>").appendTo("#tegnList");(c.type[0]=="2"||c.type[0]==
"3"||c.type[0]=="6"||c.type[0]=="7")&&$("<li id='tegnLinie' data-icon='check'><a href='#' data-rel='back' onclick='Path()'>Linie</a></li>").appendTo("#tegnList");(c.type[0]=="4"||c.type[0]=="5"||c.type[0]=="6"||c.type[0]=="7")&&$("<li id='tegnPolygon' data-icon='check'><a href='#' data-rel='back' onclick='Polygon()'>Polygon</a></li>").appendTo("#tegnList");c.type[0]!="0"&&($("<li id='tegnRediger' data-icon='check'><a href='#' data-rel='back' onclick='Modify()'>Rediger</a></li>").appendTo("#tegnList"),
$("<li id='tegnNaviger' data-icon='check' class='checked'><a href='#' data-rel='back' onclick='Navigate()'>Naviger</a></li>").appendTo("#tegnList"),$("#tegnList").listview("refresh"));if(c.Url)Rfs.url=c.Url[0]}}$("#Kort");a=$("#headerKort").html("");$("<a data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-a' data-theme='a' data-icon='locate' onclick='locate()' >Position</a>").button().appendTo(a);oiorest.items.length>0?($("<a data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-b' data-theme='a' href='#SearchPage1' data-icon='search' >S\u00f8g</a>").button().appendTo(a),
Rfs.useDrawControl?($("<a data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-c' data-theme='a' href='#Tegn' data-icon='star' data-rel='popup' data-position-to='window' >Tegn</a>").button().appendTo(a),$("<a data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-d' data-theme='a' href='#layerspage' data-icon='layers' data-rel='popup' data-position-to='window' >Kort</a>").button().appendTo(a),a.removeClass("ui-grid-a"),a.removeClass("ui-grid-b"),
a.addClass("ui-grid-c")):($("<a data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-c' data-theme='a' href='#layerspage' data-icon='layers' data-rel='popup' data-position-to='window' >Kort</a>").button().appendTo(a),a.removeClass("ui-grid-a"),a.removeClass("ui-grid-c"),a.addClass("ui-grid-b"))):Rfs.useDrawControl?($("<a data-theme='a' data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-c' href='#Tegn' data-icon='star' data-rel='popup' data-position-to='window' >Tegn</a>").button().appendTo(a),
$("<a data-theme='a' data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-d' href='#layerspage' data-icon='layers' data-rel='popup' data-position-to='window' >Kort</a>").button().appendTo(a),a.removeClass("ui-grid-a"),a.removeClass("ui-grid-c"),a.addClass("ui-grid-b")):($("<a data-theme='a' data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-c' href='#layerspage' data-icon='layers' data-rel='popup' data-position-to='window' >Kort</a>").button().appendTo(a),
a.removeClass("ui-grid-b"),a.removeClass("ui-grid-c"),a.addClass("ui-grid-a"));if(oiorest.items.length>1){$("#searchOptionsDiv").html("<fieldset id='searchOptions' data-role='controlgroup'><legend>S\u00f8gemuligheder</legend></fieldset>");for(f in oiorest.items)oiorest.items[f].createCheckBox();$("#SearchPage1").trigger("create")}else $("#searchOptionsDiv").html("")}Rfs.url?(f=Rfs.url.replace("Data.aspx/Index","api/DataApi.aspx"),Rfs.url=Rfs.url.substr(0,Rfs.url.indexOf("/Data.aspx/Index")),$.mobile.showPageLoadingMsg("a",
"Henter formular...",!1),$.ajax({url:f,dataType:"jsonp",success:function(a){Rfs.createform(a,e)},error:function(){$.mobile.changePage("#ShowKommunerError")},complete:function(){$.mobile.hidePageLoadingMsg()}})):(Rfs.showInfo=!0,createMap(),$.mobile.changePage("#Kort",e))}}}))}},createform:function(b,e){Rfs.rapport=b;var c=b.Felter,a=$("#Formular").children(":jqmData(role=header)"),f=a.find("img");f[0].src=Rfs.tema.Logo;f[0].style.visibility=Rfs.tema.Logo==""?"hidden":"visible";a.find("h1").html(Rfs.tema.Navn);
a="<input type='hidden' name='FormId' value='"+Rfs.rapport.FormId+"'/>";a+="<input type='hidden' name='UniqueId' value='"+Rfs.rapport.UniqueId+"'/>";a+="<input type='hidden' name='ItemId' value='"+Rfs.rapport.ItemId+"'/>";a+="<input type='hidden' name='ViewId' value='"+Rfs.rapport.ViewId+"'/>";a+="<input type='hidden' name='UserId' value='"+Rfs.rapport.UserId+"'/>";a+="<input type='hidden' name='Date' value='"+Rfs.rapport.Date+"'/>";a+="<fieldset>";for(f=0;f<c.length;f++){var d=c[f];if(!d.Data)d.Data=
"";if(d.Permission==0)switch(handled=!0,d.TypeId){case 16:a+="<input type='hidden' name='Geometri' value='"+d.Data+"' id='Geometri'";d.Required==1&&(a+=" class=required");a+="/>";break;case 17:a+="<input type='hidden' name='Position' value='"+d.Data+"' id='Position'";d.Required==1&&(a+=" class=required");a+="/>";break;case 18:a+="<input type='hidden' name='Accuracy' value='"+d.Data+"' id='Accuracy'";d.Required==1&&(a+=" class=required");a+="/>";break;default:a+="<input type='hidden' name='"+d.Id+
"' value='"+d.Data+"' id='"+d.Id+"'",d.Required==1&&(a+=" class=required"),a+="/>"}else switch(d.TypeId){case 1:a+="<div data-role='fieldcontain'>";a+="<label for='"+d.Id+"'>"+d.Name+"</label>";a+="</div>";break;case 2:a+="<div data-role='fieldcontain'>";a+="<label for='"+d.Id+"'>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</label>";a+="<input type='text' id='"+d.Id+"' name='"+d.Id+"' value='"+d.Data+"'";d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=" />";
a+="</div>";break;case 3:a+="<div data-role='fieldcontain'>";a+="<label for='"+d.Id+"'>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</label>";a+="<select id='"+d.Id+"' name='"+d.Id+"' value='"+d.Data+"'";d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=">";a+="<option data-placeholder='true'>-- V\u00e6lg --</option>";for(var j=d.Selections,h=0;h<j.length;h++){var g=j[h];a+="<option value='"+g.Name+"'";g.Selected==1&&(a+=" selected='selected'");a+=">"+g.Name+"</option>"}a+=
"</select>";a+="</div>";break;case 4:a+="<div data-role='fieldcontain'>";a+="<fieldset data-role='controlgroup'><legend>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</legend>";j=d.Selections;for(h=0;h<j.length;h++)g=j[h],a+="<input type='radio' id='"+g.Id+"' name='"+d.Id+"' value='"+g.Name+"'",g.Selected==1&&(a+=" checked='checked'"),d.Required==1&&(a+=" class=required"),d.Permission==1&&(a+=" disabled='disabled'"),a+="/><label for='"+g.Id+"'>"+g.Name+"</label>";a+="</fieldset>";a+="</div>";break;
case 5:a+="<div data-role='fieldcontain'>";a+="<label for='"+d.Id+"'>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</label>";a+="<textarea id='"+d.Id+"' name='"+d.Id+"'";d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=">";a+=d.Data;a+="</textarea>";a+="</div>";break;case 6:a+="<div data-role='fieldcontain'>";a+="<fieldset data-role='controlgroup'><legend>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</legend>";a+="<input type='checkbox' id='"+d.Id+"' name='"+
d.Id+"'";d.Data=="true"&&(a+=" checked='checked'");d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=" /><label for='"+d.Id+"'>"+d.Name+"</label>";a+="</fieldset>";a+="</div>";break;case 7:a+="<div data-role='fieldcontain'>";a+="<label for='"+d.Id+"'>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</label>";a+="<input type='email' id='"+d.Id+"' name='"+d.Id+"' value='"+d.Data+"'";d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=
" />";a+="</div>";break;case 8:a+=markupCamera(d);break;case 10:a+=markupDate(d);break;case 12:a+="<div data-role='fieldcontain'>";a+="<fieldset data-role='controlgroup'><legend>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</legend>";a+="<input type='checkbox' id='"+d.Id+"' name='"+d.Id+"'";d.Data=="true"&&(a+=" checked='checked'");d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=" /><label for='"+d.Id+"'>"+d.Name+"</label>";a+="</fieldset>";a+="</div>";break;
case 13:a+="<div data-role='fieldcontain'>";a+="<fieldset data-role='controlgroup'><legend>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</legend>";a+="<input type='checkbox' id='"+d.Id+"' name='"+d.Id+"'";d.Data=="true"&&(a+=" checked='checked'");d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=" /><label for='"+d.Id+"'>"+d.Name+"</label>";a+="</fieldset>";a+="</div>";break;case 14:a+="<div data-role='fieldcontain'>";a+="<a data-role='button' data-inline='true' href='"+
d.Data+"'>"+d.Name+"</a>";a+="</div>";break;case 15:a+="<div data-role='fieldcontain'>";a+="<label for='"+d.Id+"'>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</label>";a+="<input type='text' id='"+d.Id+"' name='"+d.Id+"' value='"+d.Data+"'";d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=" />";a+="</div>";break;case 16:a+="<div data-role='fieldcontain'>";a+="<label for='Geometri'>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</label>";a+="<textarea id='Geometri' name='Geometri'";
d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=">";a+=d.Data;a+="</textarea>";a+="</div>";break;case 17:a+="<div data-role='fieldcontain'>";a+="<label for='Position'>";d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</label>";a+="<textarea id='Position' name='Position'";d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=">";a+=d.Data;a+="</textarea>";a+="</div>";break;case 18:a+="<div data-role='fieldcontain'>";a+="<label for='Accuracy'>";
d.Required==1&&(a+="<em>*</em>");a+=d.Name+"</label>";a+="<input type='text' id='Accuracy' name='Accuracy' value='"+d.Data+"'";d.Required==1&&(a+=" class=required");d.Permission==1&&(a+=" disabled='disabled'");a+=" />";a+="</div>";break;case 22:a+="<hr />";break;case 23:a+="<h1>"+d.Name+"</h1>";break;case 24:a+="<p>"+d.Name+"</p>"}}a+="</fieldset>";$("#rapportForm").html(a).trigger("create");$(":file").bind("change",function(){imageId=this.id;if(html5File()){var a=this.files[0];if(a.type.match("image.*")){var b=
new FileReader;b.onload=function(){return function(a){$("#A"+imageId).attr("src",a.target.result).css("display","inline").removeClass("imageCamera")}}(a);b.readAsDataURL(a)}}else $("#A"+imageId).val(this.value).css("display","inline-block")});$("#rapportForm").validate();Rfs.showInfo=!0;createMap();$.mobile.changePage("#Kort",e)},showPosition:function(){$.mobile.showPageLoadingMsg("a","Henter temaer...",!1);$.ajax({url:url,dataType:"jsonp",data:{x:x,y:y},success:function(b){Rfs.kommune=b;if(b.ModtagerIndberetning)$.mobile.changePage("#Kommune?nr="+
b.Nr);else{var e=$("#ModtagerIkkeIndberetning"),c=e.children(":jqmData(role=content)"),a="";a+="<h2>Du st\u00e5r i "+b.Navn+" Kommune</h2>";a+="<p>RapportFraStedet kan ikke indberette til denne kommune!</p>";Rfs.kommune.Besked!=""&&(a+="<p>"+b.Besked+"</p>");b.URL!=""&&(a+="<a href='"+b.URL+"' rel='external' data-ajax='false' data-role='button'>Kontakt</a>");a+="<p>Du kan v\u00e6lge at indberette til en anden kommune.</p>";a+="<a href='#AlleKommuner' data-role='button' data-theme='b' >V\u00e6lg kommune</a>";
c.html(a);e.trigger("create");$.mobile.changePage("#ModtagerIkkeIndberetning")}},error:function(){$.mobile.changePage("#ShowKommunerError")},complete:function(){$.mobile.hidePageLoadingMsg()}})},Validate:function(){$("#rapportForm").valid()&&$("#Confirm").popup("open",{positionTo:"window",transition:"pop"})},showAdvarsel:function(b,e){var c=b.hash.replace(/.*nr=/,"");if(Rfs.kommuner!=null)for(var a=0;a<Rfs.kommuner.length;a++)if(Rfs.kommuner[a].Nr==c){Rfs.kommune=Rfs.kommuner[a];break}Rfs.kommune!=
null&&(c=$("#Advarsel"),a="",a+="<h2>"+Rfs.kommune.Navn+" Kommune</h2>",a+="<p>Rapport Fra Stedet kan ikke indberette til denne kommune!</p>",Rfs.kommune.Besked!=""&&(a+="<p>"+Rfs.kommune.Besked+"</p>"),Rfs.kommune.URL!=""&&(a+="<a href='"+Rfs.kommune.URL+"' rel='external' data-ajax='false' data-role='button'>Kontakt</a>"),a+="<p>Du kan v\u00e6lge at indberette til en anden kommune.</p>",a+="<a href='#AlleKommuner' data-role='button' data-theme='b' >V\u00e6lg kommune</a>",$("#update").html(a),c.trigger("create"),
$.mobile.changePage(c,e))},checkIndberetning:function(){Rfs.ajaxCheck!=null&&Rfs.ajaxCheck.abort();var b=$("#Position");b.length>0&&Rfs.lon&&Rfs.lat&&b.val("POINT("+Rfs.lon+" "+Rfs.lat+")");b=$("#Accuracy");b.length>0&&Rfs.acc&&b.val(Rfs.acc);b=$("#Geometri");b.length>0?($.mobile.showPageLoadingMsg("a","Validere placering...",!1),Rfs.ajaxCheck=$.ajax({url:Rfs.url+"/api/Tema.aspx",dataType:"jsonp",data:{id:Rfs.tema.Id,geometri:b.val()},success:function(b){b==!0?$.mobile.changePage($("#Formular"),{transition:"slide"}):
$("#GeometryError").popup("open")},error:function(){$.mobile.changePage("#ShowKommunerError")},complete:function(){$.mobile.hidePageLoadingMsg()}})):(b=$("#Geometri"),b.length>0?b.hasClass("required")?$("#GeometryError").popup("open"):$.mobile.changePage($("#Formular"),{transition:"slide"}):$.mobile.changePage($("#Formular"),{transition:"slide"}))}},kommuneNr=null;$("#SearchPage1").live("pageinit",function(){$("#search1").bind("keyup change",function(){var b=$(this).val();oiorest.search(b)})});
$("#OioVej").live("pageinit",function(){});
var oiorest={kommuneNr:null,kommuner:null,vejNr:null,ajax:[],items:null,activeSearch:null,search:function(b){for(var e=0;e<this.items.length;e++)if(this.items[e].text1!=b)this.items[e].text1=b,this.items[e].search1()},init:function(){$("#searchOptions>.ui-controlgroup-controls").html("");$("#searchResult1").html("");this.items=[];$("#SearchPage1").page();$("#SearchPage2").page();$("#SearchPage3").page();$("#searchInput2").bind("keyup change",function(){var b=$(this).val();if(b.length>=oiorest.activeSearch.chars2&&
oiorest.activeSearch.text2!=b)oiorest.activeSearch.text2=b,oiorest.activeSearch.search2()});$("#searchInput3").bind("keyup change",function(){var b=$(this).val();if(b.length>=oiorest.activeSearch.chars3&&oiorest.activeSearch.text3!=b)oiorest.activeSearch.text3=b,oiorest.activeSearch.search3()})}};
Search=function(b,e,c){this.id=b;this.title=e;this.checked=c;this.chars3=this.chars2=this.chars1=this.placeholder3=this.placeholder2=this.placeholder1=this.name3=this.name2=this.name1=this.id3=this.id2=this.id1=this.url3=this.url2=this.url1=this.title3=this.title2=this.title1=this.projection=this.url=this.y2=this.x2=this.y1=this.x1=this.ajax=null;this.text3=this.text2=this.text1="";this.selection3=this.selection2=this.selection1=null;var a=this;$("<ul>",{id:"searchList"+this.id,"data-role":"listview",
"data-inset":"true","data-count-theme":"b"}).appendTo("#searchResult1").listview();this.createCheckBox=function(){var b=$("<input>",{name:"searchOption"+this.id,id:"searchOption"+this.id,type:"checkbox"});a.checked&&b.attr("checked","checked");b.bind("change",function(b){a.checked=b.target.checked;a.checked?a.search1():$("#searchList"+a.id).html("")});b.appendTo("#searchOptions");$("<label>",{"for":"searchOption"+a.id,text:this.title}).appendTo("#searchOptions")};this.search1=function(){if(a.checked&&
($("#searchList"+a.id).html(""),a.text1.length>=a.chars1))a.ajax!=null&&a.ajax.abort(),$.mobile.showPageLoadingMsg("a","S\u00f8ger...",!1),a.ajax=$.ajax({url:a.url1.replace("[text]",a.text1).replace("[kommune]",Rfs.kommune.Nr),dataType:"jsonp",success:function(b){$("<li data-role='list-divider'>"+a.title1+"<span class='ui-li-count'>"+b.length+"</span></li>").appendTo("#searchList"+a.id);for(var d=0;d<b.length;d++){for(var c=a.name1,e=a.name1.match(/\[.+?\]/g);e.length;)var g=e.shift(),k=getPath(b[d],
g.replace("[","").replace("]","")),c=c.replace(g,k);a.addItem1(getPath(b[d],a.id1),c)}$("#searchList"+a.id).listview("refresh")},complete:function(){$.mobile.hidePageLoadingMsg()}})};this.search2=function(){$("#searchResult2").html("");a.ajax!=null&&a.ajax.abort();$.mobile.showPageLoadingMsg("a","S\u00f8ger...",!1);a.ajax=$.ajax({url:a.url2.replace("[text]",a.text2).replace("[kommune]",Rfs.kommune.Nr).replace("[selection1]",a.selection1),dataType:"jsonp",success:function(b){for(var d=0;d<b.length;d++){for(var c=
a.name2,e=a.name2.match(/\[.+?\]/g);e.length;)var g=e.shift(),k=getPath(b[d],g.replace("[","").replace("]","")),c=c.replace(g,k);a.addItem2(getPath(b[d],a.id2),c)}$("#searchResult2").listview("refresh")},complete:function(){$.mobile.hidePageLoadingMsg()}})};this.search3=function(){$("#searchResult3").html("");a.ajax!=null&&a.ajax.abort();$.mobile.showPageLoadingMsg("a","S\u00f8ger...",!1);a.ajax=$.ajax({url:a.url3.replace("[text]",a.text3).replace("[kommune]",Rfs.kommune.Nr).replace("[selection1]",
a.selection1).replace("[selection2]",a.selection2),dataType:"jsonp",success:function(b){for(var d=0;d<b.length;d++){for(var c=a.name3,e=a.name3.match(/\[.+?\]/g);e.length;)var g=e.shift(),k=getPath(b[d],g.replace("[","").replace("]","")),c=c.replace(g,k);a.addItem3(getPath(b[d],a.id3),c)}$("#searchResult3").listview("refresh")},complete:function(){$.mobile.hidePageLoadingMsg()}})};this.addItem1=function(b,d){$("<li>").append($("<a />",{text:d}).click(function(){oiorest.activeSearch=a;a.selection1=
b;a.url2?($("#SearchPage2").children(":jqmData(role=header)").find("h1").html(a.title2),$("#searchInput2").val(""),$("#searchInput2").attr("placeholder",a.placeholder2),$("#searchResult2").html(""),a.chars2>0?$("#searchHint2").html("Indtast minimum "+a.chars2+" karakterer!"):($("#searchHint2").html(""),a.text2="",a.search2()),$.mobile.changePage("#SearchPage2")):a.getPosition(d)})).appendTo("#searchList"+a.id)};this.addItem2=function(b,d){$("<li>").append($("<a />",{text:d}).click(function(){oiorest.activeSearch=
a;a.selection2=b;if(a.url3){var c=$("#SearchPage3");c.children(":jqmData(role=header)").find("h1").html(a.title3);$("#searchInput3").val("");$("#searchInput3").attr("placeholder",a.placeholder3);$("#searchResult3").html("");a.chars3>0?$("#searchHint3").html("Indtast minimum "+a.chars3+" karakterer!"):($("#searchHint3").html(""),a.text3="",a.search3());$.mobile.changePage(c)}else a.getPosition(d)})).appendTo("#searchResult2")};this.addItem3=function(b,d){$("<li>").append($("<a />",{text:d}).click(function(){oiorest.activeSearch=
a;a.selection3=b;a.getPosition(d)})).appendTo("#searchResult3")};this.getPosition=function(b){a.ajax!=null&&a.ajax.abort();$.mobile.showPageLoadingMsg("a","S\u00f8ger...",!1);a.ajax=$.ajax({url:a.url.replace("[text]",b).replace("[kommune]",Rfs.kommune.Nr).replace("[selection1]",a.selection1).replace("[selection2]",a.selection2).replace("[selection3]",a.selection3),dataType:"jsonp",success:function(b){var c=null;try{c=map.projection.getCode()}catch(e){c=map.projection}var f=null,f=c=="ETRS89.UTM-32N"?
new OpenLayers.Projection("EPSG:25832"):map.projection;a.x2?(c=new OpenLayers.Geometry.Point(getPath(b,a.x1),getPath(b,a.y1)),b=new OpenLayers.Geometry.Point(getPath(b,a.x2),getPath(b,a.y2)),c.transform(new OpenLayers.Projection(a.projection),mapPojection),b.transform(new OpenLayers.Projection(a.projection),f),f=new OpenLayers.Bounds(c.x,c.y,b.x,b.y),map.zoomToExtent(f)):(b=new OpenLayers.Geometry.Point(getPath(b,a.x1),getPath(b,a.y1)),b.transform(new OpenLayers.Projection(a.projection),f),vector.removeAllFeatures(),
vector.addFeatures([new OpenLayers.Feature.Vector(b,{},{graphicName:"cross",strokeColor:"#f00",strokeWidth:2,fillOpacity:0,pointRadius:10})]),map.zoomToExtent(vector.getDataExtent()));f=$("#Kort");$.mobile.changePage(f)},complete:function(){$.mobile.hidePageLoadingMsg()}})}};function getPath(b,e){b.length>0&&(b=b[0]);for(var c=e.split(".");c.length&&b;)b=b[c.shift()];return b}
var apiKey="AuNxzdIgj_DsnHh_sCAkkhlwPbfe1B-m890rn4sjfAG1niRi3lCjtxunctjRCn-Q",map,activeControl,pointControl,pathControl,polygonControl,modifyControl,removeControl,navigationControl,redline,vector,crosshairsLayer,crosshairMarker,icon;
function Point(){$("#tegnPunkt").addClass("checked");$("#tegnLinie").removeClass("checked");$("#tegnPolygon").removeClass("checked");$("#tegnRediger").removeClass("checked");$("#tegnSlet").removeClass("checked");$("#tegnNaviger").removeClass("checked");activeControl&&activeControl.deactivate();activeControl=pointControl;activeControl.activate()}
function Path(){$("#tegnPunkt").removeClass("checked");$("#tegnLinie").addClass("checked");$("#tegnPolygon").removeClass("checked");$("#tegnRediger").removeClass("checked");$("#tegnSlet").removeClass("checked");$("#tegnNaviger").removeClass("checked");activeControl&&activeControl.deactivate();activeControl=pathControl;activeControl.activate()}
function Polygon(){$("#tegnPunkt").removeClass("checked");$("#tegnLinie").removeClass("checked");$("#tegnPolygon").addClass("checked");$("#tegnRediger").removeClass("checked");$("#tegnSlet").removeClass("checked");$("#tegnNaviger").removeClass("checked");activeControl&&activeControl.deactivate();activeControl=polygonControl;activeControl.activate()}
function Modify(){$("#tegnPunkt").removeClass("checked");$("#tegnLinie").removeClass("checked");$("#tegnPolygon").removeClass("checked");$("#tegnRediger").addClass("checked");$("#tegnSlet").removeClass("checked");$("#tegnNaviger").removeClass("checked");activeControl&&activeControl.deactivate();activeControl=modifyControl;activeControl.activate()}
function Navigate(){$("#tegnPunkt").removeClass("checked");$("#tegnLinie").removeClass("checked");$("#tegnPolygon").removeClass("checked");$("#tegnRediger").removeClass("checked");$("#tegnSlet").removeClass("checked");$("#tegnNaviger").addClass("checked");activeControl&&activeControl.deactivate();activeControl=null}
function Move(){if(!Rfs.useDrawControl){var b=map.getExtent();crosshairMarker&&crosshairsLayer.removeMarker(crosshairMarker);crosshairMarker=new OpenLayers.Marker(new OpenLayers.LonLat(b.left+(b.right-b.left)/2,b.bottom+(b.top-b.bottom)/2),icon);crosshairsLayer.addMarker(crosshairMarker);if(Rfs.rapport&&Rfs.rapport.SRS){var e=$("#Geometri");if(e.length>0){var c=null;try{c=map.projection.getCode()}catch(a){c=map.projection}var f=null,f=c=="ETRS89.UTM-32N"?new OpenLayers.Projection("EPSG:25832"):map.projection,
c=new OpenLayers.Projection(Rfs.rapport.SRS),b=new OpenLayers.Geometry.Point(b.left+(b.right-b.left)/2,b.bottom+(b.top-b.bottom)/2);b.transform(f,c);e.val(b.toString())}}}}
function initMap(){crosshairsLayer=new OpenLayers.Layer.Markers("Crosshairs Layer");vector=new OpenLayers.Layer.Vector("Vector Layer",{});var b=new OpenLayers.Size(100,100),e=new OpenLayers.Pixel(-50,-50);icon=new OpenLayers.Icon("./img/crosshair.png",b,e);redline=new OpenLayers.Layer.Vector("Redline Layer",{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:20,graphicName:"circle",fillColor:"white",fillOpacity:0.25,strokeWidth:3,
strokeOpacity:1,strokeColor:"#ff6600"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff6600"},Polygon:{strokeWidth:3,strokeOpacity:1,fillColor:"#ff6600",strokeColor:"#ff6600"}}})]}),select:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:20,graphicName:"circle",fillColor:"white",fillOpacity:0.25,strokeWidth:3,strokeOpacity:1,strokeColor:"#ff9900"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff9900"},Polygon:{strokeWidth:3,strokeOpacity:1,fillColor:"#ff9900",
strokeColor:"#ff9900"}}})]}),temporary:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{graphicName:"circle",pointRadius:20,fillColor:"white",fillOpacity:0.25,strokeWidth:3,strokeColor:"#ff3300"},Line:{pointRadius:20,strokeWidth:3,strokeOpacity:1,strokeColor:"#ff3300"},Polygon:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff3300",fillColor:"#ff3300"}}})]})})});redline.events.register("beforefeatureadded",this,function(a){redline.removeAllFeatures();if(Rfs.rapport&&Rfs.rapport.SRS){var b=
$("#Geometri");if(b.length>0){var c=null;try{c=map.projection.getCode()}catch(e){c=map.projection}var h=null,h=c=="ETRS89.UTM-32N"?new OpenLayers.Projection("EPSG:25832"):map.projection,c=new OpenLayers.Projection(Rfs.rapport.SRS),a=a.feature.geometry.clone();a.transform(h,c);b.val(a.toString())}}});modifyControl=new OpenLayers.Control.ModifyFeature(redline);pointControl=new OpenLayers.Control.DrawFeature(redline,OpenLayers.Handler.Point);pathControl=new OpenLayers.Control.DrawFeature(redline,OpenLayers.Handler.Path);
polygonControl=new OpenLayers.Control.DrawFeature(redline,OpenLayers.Handler.Polygon);navigationControl=new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:!0}});var b=new OpenLayers.Control.Geolocate({id:"locate-control",geolocationOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:5E3}}),c={fillOpacity:0.1,fillColor:"#000",strokeColor:"#f00",strokeOpacity:0.6};b.events.register("locationupdated",this,function(a){Rfs.lat=a.position.coords.latitude;Rfs.lon=a.position.coords.longitude;
Rfs.acc=a.position.coords.accuracy;vector.removeAllFeatures();vector.addFeatures([new OpenLayers.Feature.Vector(a.point,{},{graphicName:"cross",strokeColor:"#f00",strokeWidth:2,fillOpacity:0,pointRadius:10}),new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(a.point.x,a.point.y),a.position.coords.accuracy/2,50,0),{},c)]);map.zoomToExtent(vector.getDataExtent());Rfs.useDrawControl||vector.removeAllFeatures()});map=new OpenLayers.Map({div:"map",
theme:null,controls:[b,pointControl,pathControl,polygonControl,modifyControl,navigationControl],layers:[redline,vector,crosshairsLayer],eventListeners:{move:Move}});$("#plus").click(function(){map.zoomIn()});$("#minus").click(function(){map.zoomOut()});$(window).bind("resize orientationchange",function(){fixContentHeight()});createMap()}function locate(){var b=map.getControlsBy("id","locate-control")[0];b.active?b.getCurrentLocation():b.activate()}
function createMap(){if(map&&Rfs.mapSet){geolocateRequest=!0;crosshairMarker&&crosshairsLayer.removeMarker(crosshairMarker);redline.removeAllFeatures();Navigate();$("#layerslist").html("<li data-role='divider' data-theme='a'>Baggrundskort</li>");var b=map.layers.length;for(i=0;i<b;i++)map.removeLayer(map.layers[0],!1);map.addLayer(redline);map.addLayer(vector);map.addLayer(crosshairsLayer);b=!1;for(mapGroupItem in Rfs.mapSet.MapGroup)for(mapItem in Rfs.mapSet.MapGroup[mapGroupItem].Map){var e=Rfs.mapSet.MapGroup[mapGroupItem].Map[mapItem];
switch(e.Type[0]){case "WMTS":var c=e.Extension[0].Options[0].name[0];new OpenLayers.Layer.WMTS({name:c,url:e.Extension[0].Options[0].url[0],layer:e.Extension[0].Options[0].layer[0],matrixSet:e.Extension[0].Options[0].matrixSet[0],format:e.Extension[0].Options[0].format[0],style:e.Extension[0].Options[0].style[0],opacity:0.7,isBaseLayer:!1});break;case "MapGuide":mapguide(e);break;case "OpenStreetMap":b=new OpenLayers.Layer.OSM(e.Extension[0].Options[0].name[0]);map.addLayer(b);addLayerToList(b);
b=!0;break;case "Google":c=e.Extension[0].Options[0].name[0];switch(e.Extension[0].Options[0].type[0]){case "G_PHYSICAL_MAP":case "TERRAIN":b=new OpenLayers.Layer.Google(c,{type:google.maps.MapTypeId.TERRAIN});map.addLayer(b);addLayerToList(b);b=!0;break;case "G_HYBRID_MAP":case "HYBRID":b=new OpenLayers.Layer.Google(c,{type:google.maps.MapTypeId.HYBRID});map.addLayer(b);addLayerToList(b);b=!0;break;case "G_SATELLITE_MAP":case "SATELLITE":b=new OpenLayers.Layer.Google(c,{type:google.maps.MapTypeId.SATELLITE});
map.addLayer(b);addLayerToList(b);b=!0;break;case "G_NORMAL_MAP":case "ROADMAP":b=new OpenLayers.Layer.Google(c,{type:google.maps.MapTypeId.ROADMAP}),map.addLayer(b),addLayerToList(b),b=!0}break;case "VirtualEarth":switch(c=e.Extension[0].Options[0].name[0],e.Extension[0].Options[0].type[0]){case "Road":b=new OpenLayers.Layer.Bing({key:apiKey,type:"Road",metadataParams:{mapVersion:"v1"},name:c});map.addLayer(b);addLayerToList(b);b=!0;break;case "Aerial":b=new OpenLayers.Layer.Bing({key:apiKey,type:"Aerial",
name:c});map.addLayer(b);addLayerToList(b);b=!0;break;case "Hybrid":b=new OpenLayers.Layer.Bing({key:apiKey,type:"AerialWithLabels",name:c}),map.addLayer(b),addLayerToList(b),b=!0}}}b&&($("#layerslist").listview("refresh"),map.zoomToMaxExtent());map.baseLayer&&locate()}}
function mapguide(b){var e=Rfs.tema.MapAgent.toLowerCase().replace("mapagent/mapagent.fcgi","fusion")+"/layers/mapguide/php/";$.ajax({url:e+"createsession.php",data:{username:"Anonymous"},dataType:"jsonp",success:function(c){$.ajax({url:e+"loadmap.php",type:"POST",data:{mapid:b.Extension[0].ResourceId[0],session:c.sessionId},dataType:"jsonp",success:function(a){var c=OpenLayers.INCHES_PER_UNIT.m*a.metersPerUnit;OpenLayers.INCHES_PER_UNIT.dd=c;OpenLayers.INCHES_PER_UNIT.degrees=c;OpenLayers.DOTS_PER_INCH=
96;var d=!0;b.Extension[0].Options&&b.Extension[0].Options[0].isBaseLayer&&b.Extension[0].Options[0].isBaseLayer[0]=="false"&&(d=!1);c=!1;b.Extension[0].Options&&b.Extension[0].Options[0].useOverlay&&b.Extension[0].Options[0].useOverlay[0]=="true"&&(c=!0);var e=!0;b.SingleTile&&b.SingleTile[0]=="False"&&(e=!1);var h=!1;b.Extension[0].Options&&b.Extension[0].Options[0].useHttpTile&&b.Extension[0].Options[0].useHttpTile[0]=="true"&&(h=!0);d={isBaseLayer:d,useOverlay:c,useAsyncOverlay:!0,singleTile:e,
useHttpTile:h,maxExtent:new OpenLayers.Bounds.fromArray(a.extent)};h?(e={basemaplayergroupname:a.groups[0].groupName},d.scales=a.FiniteDisplayScales,e=new OpenLayers.Layer.MapGuide(a.mapTitle,b.Extension[0].Options[0].tileCacheUrl[0].split(","),e,d)):(e?(map.projection="EPSG:"+a.epsg,e={mapname:a.mapName,session:a.sessionId,behavior:2},d.maxResolution="auto",d.maxScale=1,d.minScale=1E12,d.units="m"):(e={mapdefinition:a.mapId,session:a.sessionId,basemaplayergroupname:a.groups[0].groupName},d.scales=
a.FiniteDisplayScales),e=new OpenLayers.Layer.MapGuide(a.mapTitle,Rfs.tema.MapAgent,e,d));map.addLayer(e);$("#map").css("background-color",a.backgroundColor);map.zoomToExtent(e.maxExtent);c?(map.removeLayer(redline,!1),map.removeLayer(vector,!1),map.removeLayer(crosshairsLayer,!1),map.addLayer(redline),map.addLayer(vector),map.addLayer(crosshairsLayer)):(addLayerToList(e),$("#layerslist").listview("refresh"));map.baseLayer&&locate()},error:function(a,b){alert(b)}})},error:function(b,a){alert(a)}})}
$("#Kort").live("pageshow",function(){fixContentHeight();if(Rfs.showInfo)Rfs.showInfo=!1,Rfs.useDrawControl?$("#KortInfoDraw").popup("open"):$("#KortInfo").popup("open");window.map||initMap()});
function fixContentHeight(){var b=$(window).height(),e=$("#headerKort"),c=$("#kortnavbar"),c=b-c.outerHeight()-e.outerHeight();$("#map").css("height",c);$("#navigation").css("top",e.outerHeight()+10);window.map&&map.updateSize();$("#Photo").css("height",b);b=$("#photoButton");e=$(window).width();c=b.outerWidth();b.css("left",(e-c)/2)}
function addLayerToList(b){if(b.isBaseLayer)map.projection=b.projection.getCode();var e=$("<li>",{"data-icon":"check","class":b.visibility?"checked":""}).append($("<a />",{text:b.name}).click(function(){$.mobile.changePage("#Kort");b.isBaseLayer?(map.projection=b.projection.getCode(),map.setBaseLayer(b)):b.setVisibility(!b.getVisibility())})).appendTo("#layerslist");b.events.on({visibilitychanged:function(){$(e).toggleClass("checked")}})};
